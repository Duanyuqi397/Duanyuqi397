## setState是同步还是异步？

React的setState是异步的，因为React的渲染机制中使用`queueMicrotask`或者`MessageChannel`将更新任务添加进微任务队列或者宏任务队列中以此实现异步渲染。

为什么要使用异步渲染？在React中会将连续调用的`setState`进行**批量更新**，这样做的目的，是为了避免短时间内连续调用造成不必要的渲染，增加性能的开销。

批量更新只会在一个微任务或宏任务中进行

**在原生事件或setTimeout里，就会是同步的**

## 事件处理

1. 事件处理函数是绑定到root上而不是对应的jsx元素上，事件处理函数只能作为fiber的props
2. 绑定到root上的事件监听不是写在组件里的事件监听函数，而是一个有事件优先级，并能传递事件执行阶段标志的监听器

事件处理机制的原理：由于fiber树的特点（**生成一个fiber节点时，对应的dom节点可能还没挂载**），onClick这样的事件处理函数作为fiber节点的props，也就不能被绑定到真正的dom上，那么一个组件如果含有事件的props，就会在对应的fiber节点的commit阶段绑定一个事件监听到root上，这个事件监听是持有优先级的，这将它和优先级机制联系了起来，可以把合成事件机制当作一个协调者，负责去协调**合成事件对象、收集事件、触发真正的事件处理函数**这三个过程